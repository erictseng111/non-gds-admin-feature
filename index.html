<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>非GDS套裝行程日期設定 (React Prototype)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- React & Babel for in-browser JSX transformation -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #f3f4f6;
        }
        .date-tag, .modal-overlay {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .modal-content {
            animation: fadeInScale 0.3s ease-in-out;
        }
        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .calendar-popup {
            z-index: 60; /* Higher than modal */
            width: 42rem;
        }
        #confetti-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 70;
        }
    </style>
</head>
<body class="p-4 sm:p-8">
    <div id="root" class="w-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- Helper Functions ---
        const classNames = (...classes) => classes.filter(Boolean).join(' ');
        
        const formatDate = (date) => {
            if (!date) return '';
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            return `${year}-${month}-${day}`;
        };

        // --- Reusable DatePicker Component ---
        const DatePicker = ({ onSelect, initialText, displayValue, initialViewDate, selectionMode = 'range', isDateEnabled = () => true, hasError = false }) => {
            const [isOpen, setIsOpen] = useState(false);
            const [viewDate, setViewDate] = useState(initialViewDate || new Date());
            const [startDate, setStartDate] = useState(null);
            const [endDate, setEndDate] = useState(null);
            const [hoverDate, setHoverDate] = useState(null);
            const pickerRef = useRef(null);
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            useEffect(() => {
                if (isOpen) {
                    setViewDate(initialViewDate || new Date());
                    setStartDate(null);
                    setEndDate(null);
                }
            }, [isOpen, initialViewDate]);

            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (pickerRef.current && !pickerRef.current.contains(event.target)) setIsOpen(false);
                };
                document.addEventListener("mousedown", handleClickOutside);
                return () => document.removeEventListener("mousedown", handleClickOutside);
            }, []);

            const handleDayClick = (day) => {
                if (!day || !isDateEnabled(day)) return;
                if (selectionMode === 'single') {
                    onSelect(day);
                    setIsOpen(false);
                } else {
                    if (!startDate || (startDate && endDate)) {
                        setStartDate(day);
                        setEndDate(null);
                    } else {
                        day < startDate ? onSelect(day, startDate) : onSelect(startDate, day);
                        setIsOpen(false);
                    }
                }
            };

            const generateMonthDays = (date) => {
                const year = date.getFullYear(), month = date.getMonth();
                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const days = Array(firstDay).fill(null);
                for (let i = 1; i <= daysInMonth; i++) days.push(new Date(year, month, i));
                return days;
            };

            const renderDay = (day) => {
                if (!day) return <div key={Math.random()}></div>;
                const time = day.getTime();
                const isToday = time === today.getTime();
                const enabled = isDateEnabled(day);
                const isStart = startDate && time === startDate.getTime();
                const isEnd = endDate && time === endDate.getTime();
                let start = startDate, end = hoverDate || endDate;
                if (start && end && end < start) [start, end] = [end, start];
                const inRange = start && end && time > start.getTime() && time < end.getTime();
                const classes = classNames('h-10 w-10 flex items-center justify-center rounded-full transition-colors duration-150', isToday && 'border border-blue-500', enabled ? 'cursor-pointer' : 'text-gray-300 cursor-not-allowed', enabled && (isStart || isEnd) && 'bg-blue-600 text-white', enabled && inRange && 'bg-blue-100 text-blue-800 rounded-none', enabled && !(isStart || isEnd || inRange) && 'hover:bg-blue-100');
                return <div key={day.toString()} className={classes} onClick={() => handleDayClick(day)} onMouseEnter={() => (enabled && startDate && !endDate && setHoverDate(day))}>{day.getDate()}</div>;
            };

            const month1 = viewDate, month2 = new Date(viewDate.getFullYear(), viewDate.getMonth() + 1, 1);
            return (
                <div className="w-full relative" ref={pickerRef}>
                    <div onClick={() => setIsOpen(!isOpen)} className={classNames("w-full bg-white text-left px-3 py-2 border rounded-md shadow-sm cursor-pointer flex items-center justify-between", hasError ? 'border-red-500' : 'border-gray-300')}>
                        <span className={classNames(displayValue ? 'text-gray-800' : 'text-gray-500')}>{displayValue || initialText}</span>
                        <svg className="w-5 h-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clipRule="evenodd" /></svg>
                    </div>
                    {isOpen && (
                        <div className="calendar-popup absolute top-full left-0 mt-2 bg-white border rounded-lg shadow-xl p-4">
                            <div className="flex items-center justify-between mb-4 px-2">
                                <button onClick={() => setViewDate(new Date(viewDate.getFullYear(), viewDate.getMonth() - 1, 1))} className="p-2 rounded-full hover:bg-gray-100"><svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 19l-7-7 7-7"></path></svg></button>
                                <div className="flex-grow flex justify-around">
                                    <div className="font-semibold text-center">{month1.getFullYear()} 年 {month1.getMonth() + 1} 月</div>
                                    <div className="font-semibold text-center">{month2.getFullYear()} 年 {month2.getMonth() + 1} 月</div>
                                </div>
                                <button onClick={() => setViewDate(new Date(viewDate.getFullYear(), viewDate.getMonth() + 1, 1))} className="p-2 rounded-full hover:bg-gray-100"><svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7"></path></svg></button>
                            </div>
                            <div className="flex gap-8" onMouseLeave={() => setHoverDate(null)}>
                                {[month1, month2].map((m, i) => <div key={i} className="w-1/2"><div className="grid grid-cols-7 text-center text-xs text-gray-500 font-semibold mb-2">{['日','一','二','三','四','五','六'].map(d => <span key={d}>{d}</span>)}</div><div className="grid grid-cols-7 text-center">{generateMonthDays(m).map(renderDay)}</div></div>)}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- Frontend Preview Component ---
        const FrontendPreview = ({ settings }) => {
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [isSuccessModalOpen, setIsSuccessModalOpen] = useState(false);
            const [selectedDates, setSelectedDates] = useState({});
            const [formData, setFormData] = useState({ title: 'Mr.', name: '', email: '', adults: '1', children: '0' });
            const [formErrors, setFormErrors] = useState({});
            const confettiCanvasRef = useRef(null);
            const { restrictionType, mainRange, singleDate, multiRanges, preferences } = settings;

            useEffect(() => {
                setSelectedDates({});
                setFormData({ title: 'Mr.', name: '', email: '', adults: '1', children: '0' });
                setFormErrors({});
            }, [settings]);
            
            useEffect(() => {
                const body = document.body;
                if (isModalOpen || isSuccessModalOpen) {
                    body.style.overflow = 'hidden';
                } else {
                    body.style.overflow = 'auto';
                }
                return () => { body.style.overflow = 'auto'; };
            }, [isModalOpen, isSuccessModalOpen]);

            useEffect(() => {
                if (isSuccessModalOpen && confettiCanvasRef.current) {
                    const canvas = confettiCanvasRef.current;
                    const ctx = canvas.getContext('2d');
                    let confetti = [];
                    const confettiCount = 200;
                    const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4caf50', '#8bc34a', '#cddc39', '#ffeb3b', '#ffc107', '#ff9800', '#ff5722'];
                    canvas.width = canvas.offsetWidth; canvas.height = canvas.offsetHeight;
                    for (let i = 0; i < confettiCount; i++) confetti.push({x: Math.random() * canvas.width, y: Math.random() * canvas.height - canvas.height, r: Math.random() * 6 + 1, d: Math.random() * confettiCount, color: colors[Math.floor(Math.random() * colors.length)], tilt: Math.floor(Math.random() * 10) - 10, tiltAngle: 0, tiltAngleIncrement: Math.random() * 0.07 + 0.05});
                    let animationFrameId;
                    const draw = () => {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        for (let i = 0; i < confettiCount; i++) { const c = confetti[i]; ctx.beginPath(); ctx.lineWidth = c.r / 2; ctx.strokeStyle = c.color; ctx.moveTo(c.x + c.tilt + c.r, c.y); ctx.lineTo(c.x + c.tilt, c.y + c.tilt + c.r); ctx.stroke(); }
                        update();
                        animationFrameId = requestAnimationFrame(draw);
                    };
                    const update = () => {
                        for (let i = 0; i < confettiCount; i++) {
                            const c = confetti[i]; c.tiltAngle += c.tiltAngleIncrement; c.y += (Math.cos(c.d) + 3 + c.r / 2) / 2; c.tilt = Math.sin(c.tiltAngle) * 15;
                            if (c.y > canvas.height) confetti[i] = { ...c, x: Math.random() * canvas.width, y: -20 };
                        }
                    };
                    draw();
                    return () => cancelAnimationFrame(animationFrameId);
                }
            }, [isSuccessModalOpen]);

            const numberOfPreferences = useMemo(() => preferences.filter(Boolean).length, [preferences]);
            const { isDateEnabled, initialViewDate } = useMemo(() => {
                let checkFunc = () => false, initialDate = new Date();
                const dateWithoutTime = (d) => d ? new Date(d.getFullYear(), d.getMonth(), d.getDate()).getTime() : null;
                switch (restrictionType) {
                    case 'range': if (mainRange.start && mainRange.end) { const start = dateWithoutTime(mainRange.start), end = dateWithoutTime(mainRange.end); checkFunc = d => { const time = dateWithoutTime(d); return time >= start && time <= end; }; initialDate = mainRange.start; } break;
                    case 'single': if (singleDate) { const single = dateWithoutTime(singleDate); checkFunc = d => dateWithoutTime(d) === single; initialDate = singleDate; } break;
                    case 'multiple': if (multiRanges.length > 0) { const ranges = multiRanges.map(r => ({ start: dateWithoutTime(r.start), end: dateWithoutTime(r.end) })); checkFunc = d => { const time = dateWithoutTime(d); return ranges.some(r => time >= r.start && time <= r.end); }; initialDate = multiRanges[0].start; } break;
                }
                return { isDateEnabled: checkFunc, initialViewDate: initialDate };
            }, [restrictionType, mainRange, singleDate, multiRanges]);

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
                if (formErrors[name]) {
                    setFormErrors(prev => ({ ...prev, [name]: null }));
                }
            };
            
            const handleDateSelect = (index, date) => {
                setSelectedDates(prev => ({ ...prev, [index]: date }));
                if (index === 0 && formErrors.date0) {
                    setFormErrors(prev => ({ ...prev, date0: null }));
                }
            };

            const validateForm = () => {
                const errors = {};
                if (!formData.name.trim()) errors.name = '姓名為必填項目';
                if (!formData.email.trim()) errors.email = '電子信箱為必填項目';
                else if (!/\S+@\S+\.\S+/.test(formData.email)) errors.email = '電子信箱格式不正確';
                if (!selectedDates[0]) errors.date0 = '理想出發日 01 為必填項目';
                setFormErrors(errors);
                return Object.keys(errors).length === 0;
            };

            const handleSubmit = () => {
                if (validateForm()) {
                    setIsModalOpen(false);
                    setIsSuccessModalOpen(true);
                    setFormErrors({});
                }
            };

            return (
                <div className="w-full bg-gray-100 rounded-2xl p-6 sm:p-10 space-y-8 sticky top-8 flex flex-col items-center justify-center min-h-[600px]">
                    <div className="text-center">
                        <h1 className="text-2xl sm:text-3xl font-bold text-gray-800">前台預覽</h1>
                        <p className="mt-2 text-gray-500">點擊下方按鈕，模擬顧客預訂流程。</p>
                    </div>
                    <button onClick={() => setIsModalOpen(true)} className="px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition-transform transform hover:scale-105">顯示預訂表單</button>
                    {isModalOpen && (
                        <div className="modal-overlay fixed inset-0 bg-black bg-opacity-50 z-50 overflow-y-auto py-8">
                            <div className="modal-content relative bg-white rounded-lg shadow-xl w-full max-w-2xl mx-auto p-8 space-y-6" onClick={e => e.stopPropagation()}>
                                <button onClick={() => setIsModalOpen(false)} className="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
                                <h2 className="text-2xl font-bold text-gray-800">諮詢表單</h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div><label className="block text-sm font-medium text-gray-700 mb-1">稱謂*</label><select name="title" value={formData.title} onChange={handleInputChange} className="w-full p-2 border border-gray-300 rounded-md"><option>Mr.</option><option>Ms.</option></select></div>
                                    <div><label className="block text-sm font-medium text-gray-700 mb-1">姓名(同護照)*</label><input type="text" name="name" value={formData.name} onChange={handleInputChange} className={classNames("w-full p-2 border rounded-md", formErrors.name ? "border-red-500" : "border-gray-300")} /><p className="mt-1 text-sm text-red-600 h-4">{formErrors.name || ''}</p></div>
                                    <div className="md:col-span-2"><label className="block text-sm font-medium text-gray-700 mb-1">電子信箱*</label><input type="email" name="email" value={formData.email} onChange={handleInputChange} className={classNames("w-full p-2 border rounded-md", formErrors.email ? "border-red-500" : "border-gray-300")} /><p className="mt-1 text-sm text-red-600 h-4">{formErrors.email || ''}</p></div>
                                    <div><label className="block text-sm font-medium text-gray-700 mb-1">成人</label><select name="adults" value={formData.adults} onChange={handleInputChange} className="w-full p-2 border border-gray-300 rounded-md"><option>1</option><option>2</option></select></div>
                                    <div><label className="block text-sm font-medium text-gray-700 mb-1">孩童</label><select name="children" value={formData.children} onChange={handleInputChange} className="w-full p-2 border border-gray-300 rounded-md"><option>0</option><option>1</option></select></div>
                                </div>
                                <div>
                                    <h3 className="text-lg font-semibold text-gray-700 mb-2">請選擇預計出發日</h3>
                                    <div className="space-y-4">
                                        {Array.from({ length: numberOfPreferences }).map((_, i) => (
                                            <div key={i}><label className="block text-sm font-medium text-gray-700 mb-1">理想出發日 0{i+1}{i === 0 ? '*' : ''}</label><DatePicker selectionMode="single" onSelect={(date) => handleDateSelect(i, date)} initialText="請選擇日期" displayValue={formatDate(selectedDates[i])} isDateEnabled={isDateEnabled} initialViewDate={initialViewDate} hasError={i === 0 && !!formErrors.date0} /><p className="mt-1 text-sm text-red-600 h-4">{i === 0 ? (formErrors.date0 || '') : ''}</p></div>
                                        ))}
                                    </div>
                                </div>
                                <div className="flex justify-end"><button onClick={handleSubmit} className="px-6 py-2.5 bg-green-600 text-white font-semibold rounded-lg shadow-sm hover:bg-green-700">確認送出</button></div>
                            </div>
                        </div>
                    )}
                     {isSuccessModalOpen && (
                        <div className="modal-overlay fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                            <div className="modal-content relative bg-white rounded-lg shadow-xl w-full max-w-md text-center p-8 overflow-hidden">
                                <canvas id="confetti-canvas" ref={confettiCanvasRef}></canvas>
                                <div className="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4">
                                    <svg className="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 13l4 4L19 7" /></svg>
                                </div>
                                <h3 className="text-xl font-semibold text-gray-900">已成功送出！</h3>
                                <p className="text-gray-500 mt-2">感謝您的諮詢，我們將盡快與您聯繫。</p>
                                <button onClick={() => setIsSuccessModalOpen(false)} className="mt-6 px-6 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg shadow-sm hover:bg-gray-300">關閉</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };
        
        // --- Main Application Component ---
        const App = () => {
            const [restrictionType, setRestrictionType] = useState('range');
            const [mainRange, setMainRange] = useState({ start: null, end: null });
            const [singleDate, setSingleDate] = useState(null);
            const [multiRanges, setMultiRanges] = useState([]);
            const [preferences, setPreferences] = useState([true, true, true]);

            const handleMainRangeSelect = (start, end) => setMainRange({ start, end });
            const handleMultiRangeSelect = (start, end) => setMultiRanges(prev => [...prev, { start, end, id: Date.now() }].sort((a,b) => a.start - b.start));
            const removeMultiRange = (id) => setMultiRanges(prev => prev.filter(r => r.id !== id));
            const handlePreferenceChange = (index) => {
                const newPrefs = [...preferences];
                newPrefs[index] = !newPrefs[index];
                if (newPrefs.filter(Boolean).length > 0) setPreferences(newPrefs);
            };
            
            const mainRangeDisplay = mainRange.start && mainRange.end ? `${formatDate(mainRange.start)} → ${formatDate(mainRange.end)}` : null;
            const singleDateDisplay = singleDate ? formatDate(singleDate) : null;
            const earliestMultiRangeDate = multiRanges.length > 0 ? multiRanges[0].start : null;
            
            const settingsForPreview = { restrictionType, mainRange, singleDate, multiRanges, preferences };

            return (
                <div className="max-w-7xl mx-auto space-y-12">
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">
                        {/* --- Backend Panel --- */}
                        <div className="w-full bg-white rounded-2xl shadow-lg p-6 sm:p-10 space-y-8">
                            <div>
                                <h1 className="text-2xl sm:text-3xl font-bold text-gray-800">後台設定</h1>
                                <p className="mt-2 text-gray-500">請為此商品設定前端旅客可預訂的日期規則與偏好數量。</p>
                            </div>
                            <hr/>
                            <div className="space-y-4">
                                <h2 className="text-lg font-semibold text-gray-700">1. 選擇日期限制類型</h2>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    {['特定日期區間', '單一限定日期', '多組獨立日期'].map((label, idx) => {
                                        const value = ['range', 'single', 'multiple'][idx];
                                        return <label key={value} className="flex items-center p-4 border rounded-lg cursor-pointer transition-all has-[:checked]:bg-blue-50 has-[:checked]:border-blue-500 has-[:checked]:ring-2 has-[:checked]:ring-blue-200"><input type="radio" name="date_type" value={value} checked={restrictionType === value} onChange={() => setRestrictionType(value)} className="form-radio h-5 w-5 text-blue-600" /><span className="ml-4 text-gray-700 font-medium">{label}</span></label>;
                                    })}
                                </div>
                            </div>
                            <div className="space-y-4">
                                <h2 className="text-lg font-semibold text-gray-700">2. 設定可售日期</h2>
                                {restrictionType === 'range' && (
                                    <div className="p-5 bg-gray-50 rounded-lg border">
                                        <p className="text-sm text-gray-600 mb-4">旅客將可以在您指定的連續日期範圍內選擇出行日期。設定後，前台日曆將預設從您選擇的開始月份顯示。</p>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">選擇日期區間</label>
                                        <DatePicker onSelect={handleMainRangeSelect} initialText="選擇開始與結束日期" displayValue={mainRangeDisplay} initialViewDate={mainRange.start} />
                                    </div>
                                )}
                                {restrictionType === 'single' && (
                                    <div className="p-5 bg-gray-50 rounded-lg border">
                                        <p className="text-sm text-gray-600 mb-4">此行程僅限特定一日可出發。設定後，前台日曆將預設顯示此日期所在月份。</p>
                                        <div className="max-w-xs"><label className="block text-sm font-medium text-gray-700 mb-1">指定日期</label><DatePicker selectionMode="single" onSelect={setSingleDate} initialText="請選擇一個日期" displayValue={singleDateDisplay} initialViewDate={singleDate} /></div>
                                    </div>
                                )}
                                {restrictionType === 'multiple' && (
                                    <div className="p-5 bg-gray-50 rounded-lg border">
                                        <p className="text-sm text-gray-600 mb-4">您可以新增多個不連續的日期或區間。設定後，前台可選擇的日期必須在這些區間內，日曆也將預設從最早的日期月份開始顯示。</p>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">新增可售日期／區間</label>
                                        <DatePicker onSelect={handleMultiRangeSelect} initialText="點擊此處打開月曆..." initialViewDate={earliestMultiRangeDate} />
                                        <div className="mt-4 p-4 min-h-[80px] bg-white border rounded-md flex flex-wrap gap-3 items-start">
                                            {multiRanges.length === 0 ? <span className="text-gray-400">尚未新增任何日期...</span> : multiRanges.map(range => <div key={range.id} className="date-tag bg-blue-100 text-blue-800 text-sm font-semibold flex items-center gap-2 pl-3 pr-2 py-1.5 rounded-full"><span>{range.start.getTime() === range.end.getTime() ? formatDate(range.start) : `${formatDate(range.start)} ~ ${formatDate(range.end)}`}</span><button onClick={() => removeMultiRange(range.id)} type="button" className="w-5 h-5 bg-blue-200 text-blue-600 rounded-full flex items-center justify-center hover:bg-blue-300"><svg className="w-3 h-3" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>)}
                                        </div>
                                    </div>
                                )}
                            </div>
                            <div className="space-y-4">
                                <h2 className="text-lg font-semibold text-gray-700">3. 設定旅客偏好日期數量</h2>
                                <p className="text-sm text-gray-600">控制旅客在前台一次可選擇的日期志願數量，最少需保留一項。</p>
                                <div className="flex flex-col sm:flex-row gap-4 sm:gap-6">
                                    {preferences.map((isChecked, index) => <label key={index} className={classNames('inline-flex items-center', preferences.filter(Boolean).length === 1 && isChecked && 'opacity-70 cursor-not-allowed')}><input type="checkbox" checked={isChecked} onChange={() => handlePreferenceChange(index)} disabled={preferences.filter(Boolean).length === 1 && isChecked} className="form-checkbox h-5 w-5 text-blue-600 rounded border-gray-300"/><span className="ml-3 text-gray-700">偏好 {index + 1}</span></label>)}
                                </div>
                            </div>
                            <div className="flex justify-end gap-4 pt-4">
                                <button type="button" className="px-6 py-2.5 bg-gray-200 text-gray-700 font-semibold rounded-lg shadow-sm hover:bg-gray-300">取消</button>
                                <button type="submit" className="px-8 py-2.5 bg-green-600 text-white font-semibold rounded-lg shadow-sm hover:bg-green-700">儲存設定</button>
                            </div>
                        </div>

                        {/* --- Frontend Panel --- */}
                        <FrontendPreview settings={settingsForPreview} />
                    </div>

                    {/* --- Logic Summary --- */}
                    <div className="w-full bg-white rounded-2xl shadow-lg p-6 sm:p-10 space-y-8">
                        <div>
                            <h1 className="text-2xl sm:text-3xl font-bold text-gray-800">互動邏輯總覽</h1>
                            <p className="mt-2 text-gray-500">此文件整理了此 Prototype 中所有的使用者互動規則。</p>
                        </div>
                        <hr/>
                        <div className="space-y-6">
                            <div>
                                <h2 className="text-xl font-semibold text-gray-700 mb-3 pb-2 border-b-2 border-blue-500">1. 後台邏輯</h2>
                                <ul className="list-disc list-inside space-y-2 text-gray-600">
                                    <li><b>日期限制類型：</b>提供「特定日期區間」、「單一限定日期」、「多組獨立日期」三種模式，使用者可透過單選按鈕切換，並顯示對應設定介面。</li>
                                    <li><b>統一日期選擇器：</b>所有日期設定均使用統一的「雙月曆」組件。區間選擇模式下，點擊兩次（開始/結束）完成設定；單日模式下，點擊一次即完成。</li>
                                    <li><b>多組日期管理：</b>在「多組獨立日期」模式下，可重複新增多個不連續的日期或區間，已新增的項目會以標籤形式顯示，並可單獨刪除。</li>
                                    <li><b>旅客偏好數量：</b>可透過勾選框設定前台顯示的「理想出發日」數量（1至3個），系統會強制保留至少一個勾選項。</li>
                                </ul>
                            </div>
                             <div>
                                <h2 className="text-xl font-semibold text-gray-700 mb-3 pb-2 border-b-2 border-green-500">2. 前台邏輯</h2>
                                <ul className="list-disc list-inside space-y-2 text-gray-600">
                                    <li><b>彈出式諮詢表單：</b>點擊「顯示預訂表單」會彈出一個模擬的表單視窗，內含旅客資訊及日期選擇欄位。</li>
                                    <li><b>理想出發日選擇：</b>表單中會顯示對應後台設定數量的「理想出發日」下拉式日期選擇器。</li>
                                    <li><b>下拉式日曆：</b>點擊任一日期選擇器，會彈出雙月曆供使用者選擇。日曆中的可選日期完全受後台設定的規則限制。</li>
                                    <li><b>背景鎖定與滾動：</b>當表單彈出時，背景頁面將無法滾動與操作。若表單內容超出視窗高度，表單本身可獨立滾動。</li>
                                    <li><b>成功提交反饋：</b>點擊「確認送出」後，會關閉諮詢表單並彈出一個帶有慶祝彩帶動畫的成功訊息視窗。</li>
                                    <li><b>表單驗證：</b>點擊「確認送出」時，會觸發必填欄位（姓名、電子信箱、理想出發日 01）的驗證。若有欄位未填，將在欄位下方顯示紅色錯誤提示，並阻止表單提交。</li>
                                </ul>
                            </div>
                             <div>
                                <h2 className="text-xl font-semibold text-gray-700 mb-3 pb-2 border-b-2 border-purple-500">3. 連動邏輯</h2>
                                <ul className="list-disc list-inside space-y-2 text-gray-600">
                                    <li><b>日期可用性同步：</b>前台日曆中「可選」的日期，完全由後台當前設定的日期規則決定，其餘日期均會反灰且不可點擊，此規則確保兩邊日曆的可用性完全一致。</li>
                                    <li><b>預設顯示月份同步：</b>前台日曆打開時，會自動跳轉至後台所設定的最早可售日期的月份，方便使用者快速找到可選區間。</li>
                                    <li><b>偏好數量同步：</b>後台設定的偏好數量（1、2 或 3）會即時決定前台表單中「理想出發日」欄位的數量。</li>
                                    <li><b>即時更新：</b>所有在後台面板的設定變更，都會即時反映在右側的前台預覽區塊，無需重新整理頁面。</li>
                                    <li><b>日期格式化一致性：</b>透過統一且安全的日期格式化函式，確保後台與前台所選擇和顯示的日期完全一致，杜絕因時區問題導致的「差一天」錯誤。</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>

